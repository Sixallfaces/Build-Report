<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="WiTech - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ—Ç—á–µ—Ç–∞–º–∏">
    <link rel="icon" href="/logo.ico" type="image/x-icon">
    <title>WiTech –°—Ç—Ä–æ–π–∫–æ–Ω—Ç—Ä–æ–ª—å- –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&family=Roboto:wght@300;400;700&display=swap');
        
        :root {
            --primary: #54B0A5;
            --secondary: #3A7B8C;
            --accent: #E0F2E9;
            --dark: #1E2F40;
            --light: #F5FDFF;
        }
        
        /* –°–¢–ò–õ–ò –î–õ–Ø –§–û–†–ú–´ –í–•–û–î–ê */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .login-container {
            background: rgba(58, 123, 140, 0.9);
            padding: 40px;
            border-radius: 10px;
            border: 2px solid var(--primary);
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo img {
            width: 80px;
            height: 80px;
            margin-bottom: 15px;
        }
        
        .login-title {
            color: var(--accent);
            margin: 0 0 10px;
            font-size: 1.8rem;
        }
        
        .login-subtitle {
            color: var(--light);
            opacity: 0.8;
            margin: 0;
        }
        
        .login-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--secondary);
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
            color: var(--light);
            margin-bottom: 15px;
            font-family: 'Montserrat', sans-serif;
            box-sizing: border-box;
        }
        
        .login-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(84, 176, 165, 0.3);
        }
        
        .login-button {
            width: 100%;
            background: var(--primary);
            color: var(--dark);
            border: none;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
            transition: all 0.3s ease;
        }
        
        .login-button:hover {
            background: #4aa095;
            transform: translateY(-2px);
        }
        
        .login-error {
            color: #e74c3c;
            text-align: center;
            margin-top: 15px;
            display: none;
            font-size: 0.9rem;
        }

        /* –í–ê–®–ò –°–£–©–ï–°–¢–í–£–Æ–©–ò–ï –°–¢–ò–õ–ò */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Montserrat', sans-serif;
            background-color: var(--dark);
            color: var(--light);
            overflow-x: hidden;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--dark) 0%, #2D4B5A 100%);
        }
        
        .header-container {
            position: relative;
            width: 100%;
            padding: 20px 0;
            text-align: center;
        }
        
        .back-link {
            position: absolute;
            top: 30px;
            left: 30px;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            font-weight: 400;
            z-index: 10;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .container {
            max-width: none;
            margin: 0 20px;
            padding: 20px 0 40px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin: 0 0 40px;
            color: var(--primary);
            text-align: center;
            font-weight: 700;
        }
        
        h2 {
            color: var(--accent);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
            margin-top: 40px;
        }
        
        /* –í–∫–ª–∞–¥–∫–∏ */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--secondary);
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background: rgba(58, 123, 140, 0.3);
            border: none;
            color: var(--light);
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .tab.active {
            background: var(--primary);
            color: var(--dark);
            font-weight: 700;
        }
        
        .tab:hover:not(.active) {
            background: rgba(84, 176, 165, 0.3);
        }
        
        /* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ */
        .tab-content {
            display: none;
            padding: 20px;
            background: rgba(30, 47, 64, 0.8);
            border-radius: 0 8px 8px 8px;
            border: 1px solid var(--secondary);
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* –¢–∞–±–ª–∏—Ü—ã */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            max-height: 70vh;
            overflow-y: auto;
            border: 1px solid var(--secondary);
            border-radius: 6px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(30, 47, 64, 0.6);
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--secondary);
            border-right: 1px solid var(--secondary);
        }
        
        /* –°–¢–ò–õ–ò –î–õ–Ø –ó–ê–ì–û–õ–û–í–ö–û–í –° –°–û–†–¢–ò–†–û–í–ö–û–ô */
        th {
            background: var(--secondary);
            color: var(--accent);
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
            position: relative;
        }
        
        th:hover {
            background: var(--primary);
            color: var(--dark);
        }
        
        th.sortable::after {
            content: " ‚Üï";
            opacity: 0.6;
        }
        
        th.sorted-asc::after {
            content: " ‚Üë";
            opacity: 1;
        }
        
        th.sorted-desc::after {
            content: " ‚Üì";
            opacity: 1;
        }
        
        th.sorted-default::after {
            content: " ‚Üï";
            opacity: 0.6;
        }
        
        tr:hover {
            background: rgba(84, 176, 165, 0.1);
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        button {
            background: var(--primary);
            color: var(--dark);
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            background: #4aa095;
            transform: translateY(-2px);
        }
        
        button.secondary {
            background: var(--secondary);
            color: var(--light);
        }
        
        button.secondary:hover {
            background: #336977;
        }
        
        button.danger {
            background: #e74c3c;
            color: white;
        }
        
        button.danger:hover {
            background: #c0392b;
        }
        
        button.success {
            background: #2ecc71;
            color: white;
        }
        
        button.success:hover {
            background: #27ae60;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .action-buttons button {
            margin: 2px;
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .action-buttons button.success {
            background: #27ae60;
            color: white;
        }

        .action-buttons button.success:hover {
            background: #219653;
        }
        
        /* –§–æ—Ä–º—ã –≤–≤–æ–¥–∞ */
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--secondary);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9rem;
            box-sizing: border-box;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(84, 176, 165, 0.3);
        }
        
        input[readonly] {
            background: rgba(255, 255, 255, 0.05);
            color: var(--accent);
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }
        
        .notification.success {
            background: rgba(46, 204, 113, 0.2);
            border: 1px solid #2ecc71;
            color: #2ecc71;
        }
        
        .notification.error {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            color: #e74c3c;
        }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: var(--primary);
        }
        
        /* –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ */
        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .search-box {
            flex: 1;
            min-width: 200px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ */
        select {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            border: 1px solid var(--secondary);
            border-radius: 4px;
            padding: 8px;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9rem;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2354B0A5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 16px;
            padding-right: 30px;
        }

        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(84, 176, 165, 0.3);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è option */
        select option {
            background: var(--dark);
            color: var(--light);
            padding: 10px;
            border: none;
        }

        select option:hover,
        select option:focus,
        select option:checked {
            background: var(--primary);
            color: var(--dark);
        }

        /* –î–ª—è Firefox */
        @-moz-document url-prefix() {
            select {
                color: var(--light) !important;
                text-shadow: 0 0 0 var(--light);
            }
            
            select option {
                background: var(--dark);
                color: var(--light);
            }
            
            select option:checked {
                background: var(--primary);
                color: var(--dark);
            }
        }

        /* –î–ª—è Internet Explorer */
        @media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
            select {
                color: var(--light);
            }
            
            select option {
                background: var(--dark);
                color: var(--light);
            }
        }
        
        /* –í–æ–ª–Ω—ã */
        .waves {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%2354B0A5" fill-opacity="0.1" d="M0,192L48,197.3C96,203,192,213,288,229.3C384,245,480,267,576,250.7C672,235,768,181,864,181.3C960,181,1056,235,1152,234.7C1248,235,1344,181,1392,154.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            background-size: cover;
            z-index: -1;
        }
        
        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ß–ï–ö–ë–û–ö–°–û–í –ò –ú–ê–°–°–û–í–û–ì–û –£–î–ê–õ–ï–ù–ò–Ø */
        .checkbox-cell {
            width: 40px;
            text-align: center;
        }
        
        .checkbox-cell input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .mass-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(58, 123, 140, 0.2);
            border-radius: 6px;
            border: 1px solid var(--secondary);
        }
        
        .selected-count {
            color: var(--primary);
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è */
        .fade-out {
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: var(--dark);
            padding: 30px;
            border-radius: 10px;
            border: 2px solid var(--primary);
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .modal-title {
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ */
        .categories-list {
            border: 1px solid var(--secondary);
            border-radius: 6px;
            padding: 10px;
            background: rgba(30, 47, 64, 0.6);
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 5px;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
            border: 1px solid var(--secondary);
            transition: all 0.3s ease;
        }
        
        .category-item:hover {
            background: rgba(84, 176, 165, 0.1);
            transform: translateX(5px);
        }
        
        .category-item button {
            margin: 0;
            padding: 5px 10px;
            font-size: 0.8rem;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä—ã—Ç–æ–≥–æ input —Ñ–∞–π–ª–∞ */
        #importFileInput {
            display: none;
        }

        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –¢–ê–ë–õ–ò–¶–´ –†–ê–ë–û–¢ */
        #worksTable {
            table-layout: fixed;
            width: 100%;
        }

        /* –£–∑–∫–∏–µ –∫–æ–ª–æ–Ω–∫–∏ */
        #worksTable th:nth-child(1),
        #worksTable td:nth-child(1) {
            width: 40px;
        }

        #worksTable th:nth-child(2),
        #worksTable td:nth-child(2) {
            width: 60px;
        }

        #worksTable th:nth-child(3),
        #worksTable td:nth-child(3) {
            width: auto;
            min-width: 300px;
        }

        #worksTable th:nth-child(4),
        #worksTable td:nth-child(4) {
            width: 150px;
        }

        #worksTable th:nth-child(5),
        #worksTable td:nth-child(5) {
            width: 120px;
        }

        #worksTable th:nth-child(6),
        #worksTable td:nth-child(6) {
            width: 120px;
        }

        #worksTable th:nth-child(7),
        #worksTable td:nth-child(7) {
            width: 100px;
        }

        #worksTable th:nth-child(8),
        #worksTable td:nth-child(8) {
            width: 100px;
        }

        #worksTable th:nth-child(9),
        #worksTable td:nth-child(9) {
            width: 150px;
        }
        
        @media (max-width: 768px) {
            .back-link {
                top: 20px;
                left: 20px;
            }
            
            .container {
                margin: 0 15px;
                padding: 15px 0 30px;
            }
            
            h1 {
                font-size: 2rem;
                margin-bottom: 30px;
                padding-top: 10px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
                padding: 10px 5px;
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 8px 10px;
                font-size: 0.9rem;
            }
            
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                min-width: 100%;
            }

            #worksTable {
                table-layout: auto;
            }

            #worksTable th:nth-child(3),
            #worksTable td:nth-child(3) {
                min-width: 150px;
            }
        }

        @media (max-width: 480px) {
            .back-link {
                top: 15px;
                left: 15px;
                font-size: 0.9rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .tab {
                min-width: 100px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- –§–û–†–ú–ê –í–•–û–î–ê -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-container">
            <div class="login-logo">
                <img src="logo.png" alt="WiTech Logo">
                <h2 class="login-title">–í—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å</h2>
                <p class="login-subtitle">WiTech-–°—Ç—Ä–æ–π–∫–æ–Ω—Ç—Ä–æ–ª—å</p>
            </div>
            
            <div>
                <input type="text" id="username" class="login-input" placeholder="–õ–æ–≥–∏–Ω" autocomplete="username">
                <input type="password" id="password" class="login-input" placeholder="–ü–∞—Ä–æ–ª—å" autocomplete="current-password">
            </div>
            
            <button onclick="login()" class="login-button">–í–æ–π—Ç–∏</button>
            
            <div id="loginError" class="login-error">–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å</div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">–†–∞–∑–¥–µ–ª—ã –ø—Ä–æ–µ–∫—Ç–æ–≤</h3>
            
            <!-- –°–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
            <div class="categories-list" id="categoriesList">
                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>
            
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <input type="text" id="newCategoryName" class="login-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" style="flex: 1;">
                <button onclick="saveNewCategory()" class="success">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            
            <div class="modal-actions">
                <button onclick="closeCategoryModal()" class="secondary">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <div id="addBalanceModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –∫ –±–∞–ª–∞–Ω—Å—É</h3>
            <p>–†–∞–±–æ—Ç–∞: <span id="balanceWorkName"></span></p>
            <p>–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: <span id="currentBalance"></span></p>
            
            <input type="number" id="addBalanceAmount" class="login-input" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" step="1" min="1">
            
            <div class="modal-actions">
                <button onclick="confirmAddBalance()" class="success">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                <button onclick="closeAddBalanceModal()" class="secondary">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ (—Å–∫—Ä—ã—Ç –¥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) -->
    <div id="mainContent" style="display: none;">
        <div class="container">
            <h1>WiTech-–°—Ç—Ä–æ–π–∫–æ–Ω—Ç—Ä–æ–ª—å</h1>
            
            <div class="tabs">
                <button class="tab active" data-tab="works">üèóÔ∏è –†–∞–±–æ—Ç—ã –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</button>
                <button class="tab" data-tab="foremen">üë∑ –ë—Ä–∏–≥–∞–¥–∏—Ä—ã</button>
                <button class="tab" data-tab="accumulative">üì¶ –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è –≤–µ–¥–æ–º–æ—Å—Ç—å</button>
                <button class="tab" data-tab="all-reports">üìã –í—Å–µ –æ—Ç—á–µ—Ç—ã</button>
            </div>
            
            <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
            <div id="notification" class="notification"></div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–∞–±–æ—Ç -->
            <div id="works" class="tab-content active">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–º–∏</h2>
                
                <div class="toolbar">
                    <button id="addWork" class="success">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É –∏–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª</button>
                    <button id="addCategory" class="success">üìÅ –†–∞–∑–¥–µ–ª—ã</button>
                    <button id="saveAllWorks" class="secondary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                    <button id="exportWorks" class="secondary">üì• –í—ã–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</button>
                    <button id="importWorks" class="secondary">üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä</button>
                    <input type="file" id="importFileInput" accept=".xlsx,.xls" style="display: none;">
                    <button id="deleteSelectedWorks" class="danger" style="display: none;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
                    <div class="search-box">
                        <input type="text" id="searchWorks" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ä–∞–±–æ—Ç–∞–º...">
                    </div>
                </div>
                
                <!-- –ü–∞–Ω–µ–ª—å –º–∞—Å—Å–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π -->
                <div class="mass-actions" id="massActions" style="display: none;">
                    <span class="selected-count" id="selectedCount">0</span>
                    <span>–≤—ã–±—Ä–∞–Ω–æ</span>
                </div>
                
                <div class="loading" id="worksLoading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                
                <div class="table-container">
                    <table id="worksTable">
                        <thead>
                            <tr>
                                <th class="checkbox-cell">
                                    <input type="checkbox" id="selectAllWorks">
                                </th>
                                <th class="sortable">ID</th>
                                <th class="sortable">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                                <th class="sortable">–†–∞–∑–¥–µ–ª</th>
                                <th class="sortable">–ï–¥.–∏–∑–º.</th>
                                <th class="sortable">–ù–∞ –±–∞–ª–∞–Ω—Å–µ</th>
                                <th class="sortable">–ü—Ä–æ–µ–∫—Ç</th>
                                <th class="sortable">–ê–∫—Ç–∏–≤–Ω–æ</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="worksTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤ -->
            <div id="foremen" class="tab-content">
               <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–∏–≥–∞–¥–∏—Ä–∞–º–∏</h2>
<div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px; background: rgba(84, 176, 165, 0.1); padding: 15px; border-radius: 8px; border: 1px solid var(--primary);">
    <div style="flex-shrink: 0;">
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://t.me/Buildrep_bot" 
             alt="QR –∫–æ–¥ –¥–ª—è Telegram –±–æ—Ç–∞" 
             style="width: 120px; height: 120px; border: 2px solid var(--primary); border-radius: 8px;">
    </div>
    <div style="flex: 1;">
        <p style="margin: 0 0 10px 0; color: var(--accent); font-weight: bold; font-size: 1.1rem;">
            üì± Telegram –±–æ—Ç –¥–ª—è –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤
        </p>
        <p style="margin: 0 0 8px 0; color: var(--light);">
            <strong>–°—Å—ã–ª–∫–∞:</strong> 
            <a href="https://t.me/Buildrep_bot" target="_blank" style="color: var(--primary); text-decoration: none;">
                t.me/Buildrep_bot
            </a>
        </p>
        <p style="margin: 0; color: var(--light); opacity: 0.8; font-size: 0.9rem;">
            –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–æ—Ç—É
        </p>
    </div>
</div>
                
                <div class="toolbar">
                    <button id="saveAllForemen" class="secondary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                    <div class="search-box">
                        <input type="text" id="searchForemen" placeholder="–ü–æ–∏—Å–∫ –ø–æ –±—Ä–∏–≥–∞–¥–∏—Ä–∞–º...">
                    </div>
                </div>
                
                <div class="loading" id="foremenLoading">–ó–∞–≥—Ä—É–∑–∫–∞ –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤...</div>
                
                <div class="table-container">
                    <table id="foremenTable">
                        <thead>
                            <tr>
                                <th width="150">ID</th>
                                <th>–§–∞–º–∏–ª–∏—è –∏ –∏–º—è</th>
                                <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
                                <th>Username</th>‚êä
                                <th width="200">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>‚êä
                                <th width="150">–î–æ—Å—Ç—É–ø</th>
                                <th width="200">–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="foremenTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –æ—Ç—á–µ—Ç–æ–≤ -->
            <div id="reports" class="tab-content">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞–º–∏</h2>
                
                <div class="toolbar">
                    <button id="addReport" class="success">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç</button>
                    <button id="saveAllReports" class="secondary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                    <div class="search-box">
                        <input type="text" id="searchReports" placeholder="–ü–æ–∏—Å–∫ –ø–æ –æ—Ç—á–µ—Ç–∞–º...">
                    </div>
                </div>
                
                <div class="loading" id="reportsLoading">–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á–µ—Ç–æ–≤...</div>
                
                <div class="table-container">
                    <table id="reportsTable">
                        <thead>
                            <tr>
                                <th width="50">ID</th>
                                <th width="100">ID –±—Ä–∏–≥–∞–¥–∏—Ä–∞</th>
                                <th width="100">ID —Ä–∞–±–æ—Ç—ã</th>
                                <th width="100">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                <th width="120">–î–∞—Ç–∞</th>
                                <th width="120">–í—Ä–µ–º—è</th>
                                <th>–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ</th>
                                <th width="150">–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–π –≤–µ–¥–æ–º–æ—Å—Ç–∏ -->
            <div id="accumulative" class="tab-content">
                <h2>–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è –≤–µ–¥–æ–º–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç</h2>
                
                <div class="toolbar">
                    <button id="refreshAccumulative" class="secondary">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                    <button id="exportAccumulative" class="secondary">üì• –°–∫–∞—á–∞—Ç—å XLS</button>
                    <div class="search-box">
                        <input type="text" id="searchAccumulative" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–ª–∏ —Ä–∞–±–æ—Ç–µ...">
                    </div>
                </div>
                
                <div class="loading" id="accumulativeLoading">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–π –≤–µ–¥–æ–º–æ—Å—Ç–∏...</div>
                
                <div class="table-container">
                    <table id="accumulativeTable">
                        <thead>
                            <tr>
                                <th>–†–∞–∑–¥–µ–ª</th>
                                <th>–†–∞–±–æ—Ç–∞</th>
                                <th>–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è</th>
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                <th>–ü—Ä–æ–µ–∫—Ç</th>
                                <th>%–í—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="accumulativeTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –≤—Å–µ—Ö –æ—Ç—á–µ—Ç–æ–≤ -->
            <div id="all-reports" class="tab-content">
                <h2>–í—Å–µ –æ—Ç—á–µ—Ç—ã (—Å–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)</h2>
                
                <div class="toolbar">
                    <button id="refreshAllReports" class="secondary">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                    <div class="search-box">
                        <input type="text" id="searchAllReports" placeholder="–ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –æ—Ç—á–µ—Ç–∞–º...">
                    </div>
                </div>
                
                <div class="loading" id="allReportsLoading">–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á–µ—Ç–æ–≤...</div>
                
                <div class="table-container">
                    <table id="allReportsTable">
                        <thead>
                            <tr>
                                <th width="50">ID</th>
                                <th>–ë—Ä–∏–≥–∞–¥–∏—Ä</th>
                                <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
                                <th>–†–∞–±–æ—Ç–∞</th>
                                <th width="100">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                <th width="120">–î–∞—Ç–∞</th>
                                <th width="120">–í—Ä–µ–º—è</th>
                                <th>–§–æ—Ç–æ</th>
                                <th width="150">–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="allReportsTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="waves"></div>
    </div>

    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
        const API_CONFIG = {
        BASE_URL: 'https://build-report.ru/',
        ENDPOINTS: {
            WORKS: 'api/works',
            ALL_WORKS: 'api/all-works',
            FOREMEN: 'api/foremen',
            REPORTS: 'api/reports',
            ALL_REPORTS: 'api/all-reports',
            REPORT: 'api/report',
            LOGIN: 'api/site-login',
            CATEGORIES: 'api/categories',
            ACCUMULATIVE: 'api/accumulative-statement',
            WORK_REPORTS: 'api/work-reports'
        }
    };

    function buildApiUrl(endpoint) {
        if (!endpoint) {
            return API_CONFIG.BASE_URL;
        }

        if (/^https?:\/\//i.test(endpoint)) {
            return endpoint;
        }

        const normalizedBase = API_CONFIG.BASE_URL.replace(/\/+$/, '');
        const normalizedPath = String(endpoint).replace(/^\/+/, '');
        return `${normalizedBase}/${normalizedPath}`;
    }

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    let works = [];
    let foremen = [];
    let reports = [];
    let allReports = [];
    let categories = [];

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    let currentSortColumn = -1;
    let sortDirection = 0; // 0 - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, 1 - –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é, -1 - –ø–æ —É–±—ã–≤–∞–Ω–∏—é
    let originalWorksOrder = []; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
    let currentWorkIdForBalance = null;
    let currentWorkBalance = 0;
    
    // –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    const UNITS = ['—à—Ç', '–º', '–º¬≤', '–º¬≥', '–∫–≥', '—Ç', '–ª', '–ø.–º.', '–∫–æ–º–ø–ª–µ–∫—Ç'];

    // –§–£–ù–ö–¶–ò–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
    async function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const errorElement = document.getElementById('loginError');
        
        // –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
        if (!username || !password) {
            errorElement.textContent = '–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å';
            errorElement.style.display = 'block';
            return;
        }
        
        try {
            const response = await fetch(buildApiUrl(API_CONFIG.ENDPOINTS.LOGIN), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ username, password })
            });

            if (!response.ok) {
                let errorMessage = '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å';

                try {
                    const errorData = await response.json();

                    if (errorData?.error) {
                        errorMessage = errorData.error;
                    } else if (errorData?.detail) {
                        errorMessage = Array.isArray(errorData.detail)
                            ? errorData.detail.map(item => item.msg || item).join(', ')
                            : errorData.detail;
                    }
                } catch (parseError) {
                    console.error('Login error parse failed:', parseError);
                }

                errorElement.textContent = errorMessage;
                errorElement.style.display = 'block';
                document.getElementById('password').value = '';
                return;
            }

            const data = await response.json();
            
            if (data.success) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                localStorage.setItem('authenticated', 'true');
                localStorage.setItem('user', JSON.stringify(data.user));
                localStorage.setItem('token', data.token || '');
                
                // –°–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                initializeApp();
            } else {
                errorElement.textContent = data.error || '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
                errorElement.style.display = 'block';
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è
                document.getElementById('password').value = '';
            }
        } catch (error) {
            console.error('Login error:', error);
            errorElement.textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É';
            errorElement.style.display = 'block';
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è
            document.getElementById('password').value = '';
        }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function checkAuth() {
        const isAuthenticated = localStorage.getItem('authenticated') === 'true';
        
        if (isAuthenticated) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏—Å—Ç–µ–∫ –ª–∏ —Ç–æ–∫–µ–Ω (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            if (token && user) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                initializeApp();
            } else {
                // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
                showLoginForm();
            }
        } else {
            showLoginForm();
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
    function showLoginForm() {
        document.getElementById('loginOverlay').style.display = 'flex';
        document.getElementById('mainContent').style.display = 'none';
        
        // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
        document.getElementById('loginError').style.display = 'none';
        
        // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ª–æ–≥–∏–Ω–∞
        document.getElementById('username').focus();
    }

    // –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞
    function logout() {
        localStorage.removeItem('authenticated');
        localStorage.removeItem('user');
        localStorage.removeItem('token');
        showLoginForm();
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø API –ó–ê–ü–†–û–°–û–í
    async function makeApiRequest(endpoint, options = {}) {
        const token = localStorage.getItem('token');
        
        const headers = {
            'Content-Type': 'application/json',
            ...options.headers
        };
        
        if (token) {
            headers['Authorization'] = `Bearer ${token}`;
        }
        
        try {
            const url = buildApiUrl(endpoint);
            const response = await fetch(url, {
                headers,
                ...options
            });
            
            if (response.status === 401) {
                logout();
                return { success: false, error: '–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞' };
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—Ç–≤–µ—Ç —É—Å–ø–µ—à–Ω—ã–π
            if (!response.ok) {
                const errorText = await response.text();
                console.error(`API Error: ${response.status} - ${errorText}`);
                return { 
                    success: false, 
                    error: `HTTP ${response.status}: ${errorText || 'Unknown error'}` 
                };
            }
            
            const data = await response.json();
            return data;
            
        } catch (error) {
            console.error('API Request failed:', error);
            return { 
                success: false, 
                error: `Network error: ${error.message}` 
            };
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ —Ñ–æ—Ä–º–µ –≤—Ö–æ–¥–∞
    document.addEventListener('DOMContentLoaded', function() {
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
        document.getElementById('username').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });
        
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        checkAuth();
    });

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    function initializeApp() {
        initializeTabs();
        initializeWorksTab();
        initializeForemenTab();
        initializeReportsTab();
        initializeAllReportsTab();
        initializeAccumulativeTab();
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        loadWorks();
        loadForemen();
        loadReports();
        loadAllReports();
        loadCategories();
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫
    function initializeTabs() {
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
                tabs.forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                this.classList.add('active');
                document.getElementById(tabId).classList.add('active');

                // –ó–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
                if (tabId === 'accumulative') {
                    loadAccumulativeStatement();
                }
            });
        });
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏ —Ä–∞–±–æ—Ç
    function initializeWorksTab() {
        document.getElementById('addWork').addEventListener('click', addNewWork);
        document.getElementById('addCategory').addEventListener('click', openCategoryModal);
        document.getElementById('saveAllWorks').addEventListener('click', saveAllWorks);
        document.getElementById('searchWorks').addEventListener('input', filterWorks);
        
        document.getElementById('exportWorks').addEventListener('click', exportWorksToExcel);
        document.getElementById('importWorks').addEventListener('click', triggerImportWorks);
        document.getElementById('importFileInput').addEventListener('change', handleWorksImport);
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏ –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤
    function initializeForemenTab() {
        document.getElementById('saveAllForemen').addEventListener('click', saveAllForemen);
        document.getElementById('searchForemen').addEventListener('input', filterForemen);
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏ –æ—Ç—á–µ—Ç–æ–≤
    function initializeReportsTab() {
        document.getElementById('addReport').addEventListener('click', addNewReport);
        document.getElementById('saveAllReports').addEventListener('click', saveAllReports);
        document.getElementById('searchReports').addEventListener('input', filterReports);
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏ –≤—Å–µ—Ö –æ—Ç—á–µ—Ç–æ–≤
    function initializeAllReportsTab() {
        document.getElementById('refreshAllReports').addEventListener('click', loadAllReports);
        document.getElementById('searchAllReports').addEventListener('input', filterAllReports);
    }
    
    // ========== –†–ê–ë–û–¢–´ ==========
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—Ç
    async function loadWorks() {
        const loadingElement = document.getElementById('worksLoading');
        const tableBody = document.getElementById('worksTableBody');
        
        loadingElement.style.display = 'block';
        tableBody.innerHTML = '';
        
        try {
            const data = await makeApiRequest('/api/all-works');
            
            if (data.success) {
                works = data.data || [];
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
                originalWorksOrder = [...works];
                displayWorks(works);
            } else {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–∞–±–æ—Ç: ' + data.error, 'error');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–∞–±–æ—Ç: ' + error.message, 'error');
        } finally {
            loadingElement.style.display = 'none';
        }
    }
    
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç
    function displayWorks(worksToDisplay) {
        const tableBody = document.getElementById('worksTableBody');
        tableBody.innerHTML = '';
        
        if (worksToDisplay.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ä–∞–±–æ—Ç–∞—Ö</td></tr>';
            return;
        }
        
        worksToDisplay.forEach(work => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="checkbox-cell">
                    <input type="checkbox" class="work-checkbox" value="${work.id}">
                </td>
                <td><input type="text" value="${work.id}" readonly></td>
                <td><input type="text" value="${work['–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã']}" class="editable" data-field="name"></td>
                <td>
                    <select class="editable" data-field="category">
                        ${categories.map(cat => 
                            `<option value="${cat.name}" ${cat.name === work.–ö–∞—Ç–µ–≥–æ—Ä–∏—è ? 'selected' : ''}>${cat.name}</option>`
                        ).join('')}
                        <option value="${work.–ö–∞—Ç–µ–≥–æ—Ä–∏—è}" ${!categories.find(c => c.name === work.–ö–∞—Ç–µ–≥–æ—Ä–∏—è) ? 'selected' : ''}>${work.–ö–∞—Ç–µ–≥–æ—Ä–∏—è}</option>
                    </select>
                </td>
                <td>
                    <select class="editable" data-field="unit">
                        ${UNITS.map(unit => 
                            `<option value="${unit}" ${unit === work['–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è'] ? 'selected' : ''}>${unit}</option>`
                        ).join('')}
                        <option value="${work['–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è']}" ${!UNITS.includes(work['–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è']) ? 'selected' : ''}>${work['–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è']}</option>
                    </select>
                </td>
                <td><input type="number" value="${work['–ù–∞ –±–∞–ª–∞–Ω—Å–µ']}" class="editable" data-field="balance" step="1"></td>
                <td><input type="number" value="${work['–ü—Ä–æ–µ–∫—Ç'] || 0}" class="editable" data-field="project_total" step="1"></td>
                <td>
                    <select class="editable" data-field="is_active">
                        <option value="1" ${work.is_active ? 'selected' : ''}>–î–∞</option>
                        <option value="0" ${!work.is_active ? 'selected' : ''}>–ù–µ—Ç</option>
                    </select>
                </td>
                <td class="action-buttons">
                    <button onclick="saveWork(${work.id})" class="secondary">üíæ</button>
                    <button onclick="addBalance(${work.id})" class="success" title="–î–æ–±–∞–≤–∏—Ç—å –∫ –±–∞–ª–∞–Ω—Å—É">‚ûï</button>
                    <button onclick="deleteWork(${work.id})" class="danger">üóëÔ∏è</button>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        initializeWorkCheckboxes();
        addSortingToWorksTable();
    }

    // –§–£–ù–ö–¶–ò–ò –°–û–†–¢–ò–†–û–í–ö–ò
    function addSortingToWorksTable() {
        const headers = document.querySelectorAll('#worksTable th.sortable');
        headers.forEach((header, index) => {
            header.addEventListener('click', () => sortWorksTable(index + 1)); // +1 –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - —á–µ–∫–±–æ–∫—Å
        });
    }

    function sortWorksTable(columnIndex) {
        const table = document.getElementById('worksTable');
        const tbody = table.querySelector('tbody');
        
        // –ï—Å–ª–∏ –∫–ª–∏–∫–∞–µ–º –ø–æ –¥—Ä—É–≥–æ–π –∫–æ–ª–æ–Ω–∫–µ - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        if (currentSortColumn !== columnIndex) {
            currentSortColumn = columnIndex;
            sortDirection = 1; // –ù–∞—á–∏–Ω–∞–µ–º —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
        } else {
            // –¶–∏–∫–ª–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: 0 -> 1 -> -1 -> 0
            if (sortDirection === 0) {
                sortDirection = 1;
            } else if (sortDirection === 1) {
                sortDirection = -1;
            } else {
                sortDirection = 0;
            }
        }
        
        let rows = Array.from(tbody.querySelectorAll('tr'));
        
        if (sortDirection === 0) {
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
            rows.sort((a, b) => {
                const aId = parseInt(a.cells[1].querySelector('input').value);
                const bId = parseInt(b.cells[1].querySelector('input').value);
                return originalWorksOrder.findIndex(w => w.id === aId) - originalWorksOrder.findIndex(w => w.id === bId);
            });
        } else {
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏
            rows.sort((a, b) => {
                const aCell = a.cells[columnIndex];
                const bCell = b.cells[columnIndex];
                
                let aValue = aCell.querySelector('input, select').value;
                let bValue = bCell.querySelector('input, select').value;
                
                // –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ (ID, –ë–∞–ª–∞–Ω—Å, –ü—Ä–æ–µ–∫—Ç)
                if (columnIndex === 1 || columnIndex === 5 || columnIndex === 6) {
                    aValue = parseFloat(aValue) || 0;
                    bValue = parseFloat(bValue) || 0;
                    return (aValue - bValue) * sortDirection;
                }
                
                // –î–ª—è –±—É–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–ê–∫—Ç–∏–≤–Ω–æ)
                if (columnIndex === 7) {
                    aValue = aValue === '–î–∞' ? 1 : 0;
                    bValue = bValue === '–î–∞' ? 1 : 0;
                    return (aValue - bValue) * sortDirection;
                }
                
                // –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
                return aValue.localeCompare(bValue) * sortDirection;
            });
        }
        
        // –û—á–∏—â–∞–µ–º –∏ –ø–µ—Ä–µ–∑–∞–ø–æ–ª–Ω—è–µ–º tbody
        tbody.innerHTML = '';
        rows.forEach(row => tbody.appendChild(row));
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        updateSortIndicators(columnIndex);
    }

    function updateSortIndicators(columnIndex) {
        const headers = document.querySelectorAll('#worksTable th.sortable');
        headers.forEach(header => {
            header.classList.remove('sorted-asc', 'sorted-desc', 'sorted-default');
        });
        
        const currentHeader = headers[columnIndex - 1]; // -1 –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - —á–µ–∫–±–æ–∫—Å
        if (currentHeader) {
            if (sortDirection === 1) {
                currentHeader.classList.add('sorted-asc');
            } else if (sortDirection === -1) {
                currentHeader.classList.add('sorted-desc');
            } else {
                currentHeader.classList.add('sorted-default');
            }
        }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ–∫–±–æ–∫—Å–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–∞–±–æ—Ç
    function initializeWorkCheckboxes() {
        const selectAllCheckbox = document.getElementById('selectAllWorks');
        const workCheckboxes = document.querySelectorAll('.work-checkbox');
        const deleteSelectedBtn = document.getElementById('deleteSelectedWorks');
        const massActions = document.getElementById('massActions');
        const selectedCount = document.getElementById('selectedCount');
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–í—ã–±—Ä–∞—Ç—å –≤—Å–µ"
        selectAllCheckbox.checked = false;
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è "–í—ã–±—Ä–∞—Ç—å –≤—Å–µ"
        selectAllCheckbox.addEventListener('change', function() {
            workCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
            updateMassActions();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —á–µ–∫–±–æ–∫—Å–æ–≤
        workCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', updateMassActions);
        });
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ –º–∞—Å—Å–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
        function updateMassActions() {
            const selectedCountValue = document.querySelectorAll('.work-checkbox:checked').length;
            
            if (selectedCountValue > 0) {
                deleteSelectedBtn.style.display = 'inline-block';
                massActions.style.display = 'flex';
                selectedCount.textContent = selectedCountValue;
                selectAllCheckbox.checked = selectedCountValue === workCheckboxes.length;
            } else {
                deleteSelectedBtn.style.display = 'none';
                massActions.style.display = 'none';
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –º–∞—Å—Å–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
        deleteSelectedBtn.onclick = deleteSelectedWorks;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        updateMassActions();
    }
    
    // –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç
    async function deleteSelectedWorks() {
        const selectedCheckboxes = document.querySelectorAll('.work-checkbox:checked');
        
        if (selectedCheckboxes.length === 0) {
            showNotification('–ù–µ –≤—ã–±—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π —Ä–∞–±–æ—Ç—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è', 'error');
            return;
        }
        
        const workIds = Array.from(selectedCheckboxes).map(checkbox => parseInt(checkbox.value));
        
        if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å ${workIds.length} –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç?`)) {
            return;
        }
        
        try {
            // –°–Ω–∞—á–∞–ª–∞ –∞–Ω–∏–º–∏—Ä—É–µ–º –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫
            selectedCheckboxes.forEach(checkbox => {
                const row = checkbox.closest('tr');
                row.classList.add('fade-out');
            });
            
            // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
            await new Promise(resolve => setTimeout(resolve, 300));
            
            // –£–¥–∞–ª—è–µ–º –∫–∞–∂–¥—É—é –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É
            const deletePromises = workIds.map(workId => 
                makeApiRequest(`${API_CONFIG.ENDPOINTS.WORKS}/${workId}`, {
                    method: 'DELETE'
                })
            );
            
            // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —É–¥–∞–ª–µ–Ω–∏—è
            await Promise.all(deletePromises);
            
            // –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
            await loadWorks();
            
            showNotification(`–£—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ ${workIds.length} —Ä–∞–±–æ—Ç`, 'success');
            
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–º —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç: ' + error.message, 'error');
            // –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, —É–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
            selectedCheckboxes.forEach(checkbox => {
                const row = checkbox.closest('tr');
                row.classList.remove('fade-out');
            });
        }
    }
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã
    function addNewWork() {
        const tableBody = document.getElementById('worksTableBody');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å—Ç—Ä–æ–∫–∞ "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"
        if (tableBody.innerHTML.includes('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ä–∞–±–æ—Ç–∞—Ö')) {
            tableBody.innerHTML = '';
        }
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="checkbox-cell">
                <!-- –ù–µ –¥–æ–±–∞–≤–ª—è–µ–º —á–µ–∫–±–æ–∫—Å –¥–ª—è –Ω–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –µ—â–µ –Ω–µ –∏–º–µ–µ—Ç ID -->
            </td>
            <td><input type="text" value="–Ω–æ–≤—ã–π" readonly></td>
            <td><input type="text" value="" class="editable" data-field="name"></td>
            <td>
                <select class="editable" data-field="category">
                    ${categories.map(cat => `<option value="${cat.name}">${cat.name}</option>`).join('')}
                </select>
            </td>
            <td>
                <select class="editable" data-field="unit">
                    ${UNITS.map(unit => `<option value="${unit}">${unit}</option>`).join('')}
                </select>
            </td>
            <td><input type="number" value="0" class="editable" data-field="balance" step="1"></td>
            <td><input type="number" value="0" class="editable" data-field="project_total" step="1"></td>
            <td>
                <select class="editable" data-field="is_active">
                    <option value="1" selected>–î–∞</option>
                    <option value="0">–ù–µ—Ç</option>
                </select>
            </td>
            <td class="action-buttons">
                <button onclick="saveNewWork(this)" class="success">‚ûï –°–æ–∑–¥–∞—Ç—å</button>
                <button onclick="removeNewWork(this)" class="danger">‚ùå</button>
            </td>
        `;
        tableBody.prepend(row);
    }
    
    // –£–¥–∞–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–¥—É–º–∞–ª)
    function removeNewWork(button) {
        const row = button.closest('tr');
        row.remove();
        
        // –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        const tableBody = document.getElementById('worksTableBody');
        if (tableBody.children.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ä–∞–±–æ—Ç–∞—Ö</td></tr>';
        }
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã
    async function saveNewWork(button) {
        const row = button.closest('tr');
        const inputs = row.querySelectorAll('.editable');
        
        const workData = {};
        inputs.forEach(input => {
            const field = input.getAttribute('data-field');
            let value = input.value;
            
            if (field === 'balance' || field === 'project_total') value = parseFloat(value);
            if (field === 'is_active') value = parseInt(value);
            
            workData[field] = value;
        });
        
        const workName = workData.name;
        const category = workData.category;
        
        const apiData = {
            name: workData.name,
            category: workData.category,
            unit: workData.unit,
            balance: workData.balance,
            project_total: workData.project_total,
            is_active: workData.is_active
        };
        
        try {
            showNotification('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...', 'success');
            
            const response = await fetch(buildApiUrl(API_CONFIG.ENDPOINTS.WORKS), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify(apiData)
            });
            
            const workAdded = await checkIfWorkExists(workName, category);
            
            if (workAdded) {
                showNotification('–†–∞–±–æ—Ç–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success');
            } else {
                let errorMessage = '–†–∞–±–æ—Ç–∞ –Ω–µ –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö';
                try {
                    const errorText = await response.text();
                    if (errorText) {
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.detail || errorData.error || errorMessage;
                    }
                } catch (e) {}
                showNotification(`–û—à–∏–±–∫–∞: ${errorMessage}`, 'error');
            }
            
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã: ' + error.message, 'error');
        }
    }

    async function checkIfWorkExists(workName, category, maxAttempts = 5) {
        for (let attempt = 0; attempt < maxAttempts; attempt++) {
            await loadWorks();
            const exists = works.some(work => 
                work['–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã'] === workName && 
                work.–ö–∞—Ç–µ–≥–æ—Ä–∏—è === category
            );
            if (exists) return true;
            await new Promise(resolve => setTimeout(resolve, 500));
        }
        return false;
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
    async function saveWork(workId) {
        const row = document.querySelector(`tr:has(input[value="${workId}"])`);
        const inputs = row.querySelectorAll('.editable');
        
        const workData = { id: workId };
        inputs.forEach(input => {
            const field = input.getAttribute('data-field');
            let value = input.value;
            
            if (field === 'balance' || field === 'project_total') value = parseFloat(value);
            if (field === 'is_active') value = parseInt(value);
            
            workData[field] = value;
        });
        
        const apiData = {
            name: workData.name,
            category: workData.category,
            unit: workData.unit,
            balance: workData.balance,
            project_total: workData.project_total,
            is_active: workData.is_active
        };
        
        try {
            const originalWork = works.find(work => work.id === workId);
            if (!originalWork) {
                showNotification('–†–∞–±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                return;
            }
            
            showNotification('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...', 'success');
            
            const response = await fetch(buildApiUrl(`${API_CONFIG.ENDPOINTS.WORKS}/${workId}`), {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify(apiData)
            });
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            await loadWorks();
            
            const updatedWork = works.find(work => work.id === workId);
            
            if (updatedWork) {
                const isUpdated = 
                    updatedWork['–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã'] === workData.name &&
                    updatedWork.–ö–∞—Ç–µ–≥–æ—Ä–∏—è === workData.category &&
                    updatedWork['–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è'] === workData.unit &&
                    parseFloat(updatedWork['–ù–∞ –±–∞–ª–∞–Ω—Å–µ']) === workData.balance &&
                    parseFloat(updatedWork['–ü—Ä–æ–µ–∫—Ç'] || 0) === workData.project_total &&
                    Boolean(updatedWork.is_active) === Boolean(workData.is_active);
                
                if (isUpdated) {
                    showNotification('–†–∞–±–æ—Ç–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
                } else {
                    showNotification('–†–∞–±–æ—Ç–∞ –Ω–∞–π–¥–µ–Ω–∞, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'warning');
                }
            } else {
                let errorMessage = '–†–∞–±–æ—Ç–∞ –Ω–µ –±—ã–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö';
                try {
                    const errorText = await response.text();
                    if (errorText) {
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.detail || errorData.error || errorMessage;
                    }
                } catch (e) {}
                showNotification(`–û—à–∏–±–∫–∞: ${errorMessage}`, 'error');
            }
            
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã: ' + error.message, 'error');
        }
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–∞–±–æ—Ç
    async function saveAllWorks() {
        const rows = document.querySelectorAll('#worksTableBody tr');
        let hasChanges = false;
        let successCount = 0;
        let errorCount = 0;
        
        showNotification('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π...', 'success');
        
        for (const row of rows) {
            const idInput = row.querySelector('td:nth-child(2) input');
            if (!idInput || idInput.value === '–Ω–æ–≤—ã–π') continue;
            
            const workId = parseInt(idInput.value);
            const inputs = row.querySelectorAll('.editable');
            
            const workData = { id: workId };
            inputs.forEach(input => {
                const field = input.getAttribute('data-field');
                let value = input.value;
                
                if (field === 'balance' || field === 'project_total') value = parseFloat(value);
                if (field === 'is_active') value = parseInt(value);
                
                workData[field] = value;
            });
            
            const apiData = {
                name: workData.name,
                category: workData.category,
                unit: workData.unit,
                balance: workData.balance,
                project_total: workData.project_total,
                is_active: workData.is_active
            };
            
            try {
                const response = await fetch(buildApiUrl(`${API_CONFIG.ENDPOINTS.WORKS}/${workId}`), {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify(apiData)
                });
                
                await new Promise(resolve => setTimeout(resolve, 500));
                
                if (successCount + errorCount === rows.length - 1) {
                    await loadWorks();
                }
                
                successCount++;
                hasChanges = true;
                
            } catch (error) {
                errorCount++;
            }
        }
        
        await loadWorks();
        
        if (hasChanges) {
            let message = `–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ä–∞–±–æ—Ç: ${successCount}`;
            if (errorCount > 0) {
                message += `, –æ—à–∏–±–æ–∫: ${errorCount}`;
            }
            showNotification(message, 'success');
        } else {
            showNotification('–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'success');
        }
    }
    
    // –£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
    async function deleteWork(workId) {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ä–∞–±–æ—Ç—É?')) {
            try {
                const row = document.querySelector(`tr:has(input[value="${workId}"])`);
                row.classList.add('fade-out');
                await new Promise(resolve => setTimeout(resolve, 300));
                
                const response = await makeApiRequest(`${API_CONFIG.ENDPOINTS.WORKS}/${workId}`, {
                    method: 'DELETE'
                });
                
                if (response.success) {
                    await loadWorks();
                    showNotification('–†–∞–±–æ—Ç–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞', 'success');
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã: ' + (response.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã: ' + error.message, 'error');
            }
        }
    }
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç
    function filterWorks() {
        const searchTerm = document.getElementById('searchWorks').value.toLowerCase();
        const filteredWorks = works.filter(work => 
            work['–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã'].toLowerCase().includes(searchTerm) ||
            work.–ö–∞—Ç–µ–≥–æ—Ä–∏—è.toLowerCase().includes(searchTerm) ||
            work['–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è'].toLowerCase().includes(searchTerm)
        );
        displayWorks(filteredWorks);
    }
    
    // ========== –§–£–ù–ö–¶–ò–ò –ò–ú–ü–û–†–¢–ê/–≠–ö–°–ü–û–†–¢–ê XLS ==========
    async function exportWorksToExcel() {
        try {
            showNotification('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è...', 'success');
            
            const workbook = XLSX.utils.book_new();
            workbook.Props = {
                Title: "–°–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç",
                Subject: "–†–∞–±–æ—Ç—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏",
                Author: "WiTech System",
                CreatedDate: new Date()
            };

            const exportData = works.map(work => ({
                'ID': work.id,
                '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã': work['–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã'],
                '–ö–∞—Ç–µ–≥–æ—Ä–∏—è': work.–ö–∞—Ç–µ–≥–æ—Ä–∏—è,
                '–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è': work['–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è'],
                '–ù–∞ –±–∞–ª–∞–Ω—Å–µ': work['–ù–∞ –±–∞–ª–∞–Ω—Å–µ'],
                '–ü—Ä–æ–µ–∫—Ç': work['–ü—Ä–æ–µ–∫—Ç'] || 0,
                '–ê–∫—Ç–∏–≤–Ω–∞': work.is_active ? '–î–∞' : '–ù–µ—Ç'
            }));

            const worksheet = XLSX.utils.json_to_sheet(exportData);
            
            const colWidths = [
                { wch: 8 },   // ID
                { wch: 40 },  // –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
                { wch: 20 },  // –ö–∞—Ç–µ–≥–æ—Ä–∏—è
                { wch: 15 },  // –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è
                { wch: 12 },  // –ù–∞ –±–∞–ª–∞–Ω—Å–µ
                { wch: 12 },  // –ü—Ä–æ–µ–∫—Ç
                { wch: 10 }   // –ê–∫—Ç–∏–≤–Ω–∞
            ];
            worksheet['!cols'] = colWidths;

            XLSX.utils.book_append_sheet(workbook, worksheet, "–†–∞–±–æ—Ç—ã");

            const fileName = `works_export_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(workbook, fileName);
            
            showNotification('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω', 'success');
        } catch (error) {
            console.error('Export error:', error);
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞: ' + error.message, 'error');
        }
    }

    function triggerImportWorks() {
        document.getElementById('importFileInput').click();
    }

    async function handleWorksImport(event) {
        const file = event.target.files[0];
        if (!file) return;
        event.target.value = '';

        try {
            showNotification('–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...', 'success');
            const data = await readExcelFile(file);
            await importWorksFromExcel(data);
        } catch (error) {
            console.error('Import error:', error);
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞: ' + error.message, 'error');
        }
    }

    function readExcelFile(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    resolve(jsonData);
                } catch (error) {
                    reject(error);
                }
            };
            reader.onerror = function() {
                reject(new Error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞'));
            };
            reader.readAsArrayBuffer(file);
        });
    }

    async function importWorksFromExcel(excelData) {
        if (!excelData || excelData.length === 0) {
            throw new Error('–§–∞–π–ª –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö');
        }

        let importedCount = 0;
        let updatedCount = 0;
        let errors = [];

        showNotification(`–ù–∞—á–∏–Ω–∞–µ–º –∏–º–ø–æ—Ä—Ç ${excelData.length} –∑–∞–ø–∏—Å–µ–π...`, 'success');

        for (let i = 0; i < excelData.length; i++) {
            const row = excelData[i];
            try {
                if (!row['–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã'] || !row['–ö–∞—Ç–µ–≥–æ—Ä–∏—è'] || !row['–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è']) {
                    errors.push(`–°—Ç—Ä–æ–∫–∞ ${i + 2}: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è`);
                    continue;
                }

                const workData = {
                    name: String(row['–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã']).trim(),
                    category: String(row['–ö–∞—Ç–µ–≥–æ—Ä–∏—è']).trim(),
                    unit: String(row['–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è']).trim(),
                    balance: parseFloat(row['–ù–∞ –±–∞–ª–∞–Ω—Å–µ']) || 0,
                    project_total: parseFloat(row['–ü—Ä–æ–µ–∫—Ç']) || 0,
                    is_active: String(row['–ê–∫—Ç–∏–≤–Ω–∞']).toLowerCase() === '–¥–∞' ? 1 : 0
                };

                const existingWorkId = row['ID'] ? parseInt(row['ID']) : null;
                
                if (existingWorkId && works.find(w => w.id === existingWorkId)) {
                    const response = await makeApiRequest(`${API_CONFIG.ENDPOINTS.WORKS}/${existingWorkId}`, {
                        method: 'PUT',
                        body: JSON.stringify(workData)
                    });
                    
                    if (response && response.success) {
                        updatedCount++;
                    } else {
                        errors.push(`–°—Ç—Ä–æ–∫–∞ ${i + 2}: –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã ID ${existingWorkId}`);
                    }
                } else {
                    const response = await makeApiRequest(API_CONFIG.ENDPOINTS.WORKS, {
                        method: 'POST',
                        body: JSON.stringify(workData)
                    });
                    
                    if (response && response.success) {
                        importedCount++;
                    } else {
                        errors.push(`–°—Ç—Ä–æ–∫–∞ ${i + 2}: –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã "${workData.name}"`);
                    }
                }
            } catch (error) {
                errors.push(`–°—Ç—Ä–æ–∫–∞ ${i + 2}: ${error.message}`);
            }
        }

        await loadWorks();

        let resultMessage = `–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω. –î–æ–±–∞–≤–ª–µ–Ω–æ: ${importedCount}, –æ–±–Ω–æ–≤–ª–µ–Ω–æ: ${updatedCount}`;
        if (errors.length > 0) {
            resultMessage += `. –û—à–∏–±–æ–∫: ${errors.length}`;
            console.error('Import errors:', errors);
        }
        
        showNotification(resultMessage, errors.length > 0 ? 'error' : 'success');
    }
    
    // ========== –ö–ê–¢–ï–ì–û–†–ò–ò ==========
    async function loadCategories() {
        try {
            const data = await makeApiRequest(API_CONFIG.ENDPOINTS.CATEGORIES);
            if (data.success) {
                categories = data.data || [];
                if (document.getElementById('works').classList.contains('active')) {
                    await loadWorks();
                }
            } else {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: ' + data.error, 'error');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: ' + error.message, 'error');
        }
    }
    
    function displayCategoriesInModal() {
        const categoriesList = document.getElementById('categoriesList');
        categoriesList.innerHTML = '';
        
        if (categories.length === 0) {
            categoriesList.innerHTML = '<div style="text-align: center; color: var(--accent); opacity: 0.7;">–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π</div>';
            return;
        }
        
        categories.forEach(category => {
            const categoryItem = document.createElement('div');
            categoryItem.className = 'category-item';
            categoryItem.innerHTML = `
                <span>${category.name}</span>
                <button onclick="deleteCategory(${category.id})" class="danger">üóëÔ∏è</button>
            `;
            categoriesList.appendChild(categoryItem);
        });
    }
    
    function openCategoryModal() {
        displayCategoriesInModal();
        document.getElementById('categoryModal').style.display = 'flex';
        document.getElementById('newCategoryName').value = '';
        document.getElementById('newCategoryName').focus();
    }
    
    function closeCategoryModal() {
        document.getElementById('categoryModal').style.display = 'none';
    }
    
    async function saveNewCategory() {
        const categoryName = document.getElementById('newCategoryName').value.trim();
        if (!categoryName) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', 'error');
            return;
        }
        
        try {
            showNotification('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...', 'success');
            const response = await fetch(buildApiUrl(API_CONFIG.ENDPOINTS.CATEGORIES), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify({ name: categoryName })
            });
            
            const categoryAdded = await checkIfCategoryExists(categoryName);
            
            if (categoryAdded) {
                showNotification('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success');
                document.getElementById('newCategoryName').value = '';
                displayCategoriesInModal();
                if (document.getElementById('works').classList.contains('active')) {
                    await loadWorks();
                }
            } else {
                let errorMessage = '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –±—ã–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö';
                try {
                    const errorText = await response.text();
                    if (errorText) {
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.detail || errorData.error || errorMessage;
                    }
                } catch (e) {}
                showNotification(`–û—à–∏–±–∫–∞: ${errorMessage}`, 'error');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ' + error.message, 'error');
        }
    }

    async function checkIfCategoryExists(categoryName, maxAttempts = 5) {
        for (let attempt = 0; attempt < maxAttempts; attempt++) {
            await loadCategories();
            const exists = categories.some(cat => cat.name === categoryName);
            if (exists) return true;
            await new Promise(resolve => setTimeout(resolve, 500));
        }
        return false;
    }
    
    async function deleteCategory(categoryId) {
        if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é?')) {
            return;
        }
        
        try {
            const categoryToDelete = categories.find(cat => cat.id === categoryId);
            if (!categoryToDelete) return;
            
            const categoryName = categoryToDelete.name;
            const response = await fetch(buildApiUrl(`${API_CONFIG.ENDPOINTS.CATEGORIES}/${categoryId}`), {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                }
            });
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            await loadCategories();
            
            const categoryStillExists = categories.some(cat => cat.id === categoryId);
            
            if (!categoryStillExists) {
                showNotification('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞', 'success');
                displayCategoriesInModal();
                if (document.getElementById('works').classList.contains('active')) {
                    await loadWorks();
                }
            } else {
                let errorMessage = '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö';
                try {
                    const errorText = await response.text();
                    if (errorText) {
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.detail || errorData.error || errorMessage;
                    }
                } catch (e) {}
                showNotification(`–û—à–∏–±–∫–∞: ${errorMessage}`, 'error');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ' + error.message, 'error');
        }
    }

    // ========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –î–û–ë–ê–í–õ–ï–ù–ò–Ø –ë–ê–õ–ê–ù–°–ê ==========
    function addBalance(workId) {
        const work = works.find(w => w.id === workId);
        if (!work) return;
        
        currentWorkIdForBalance = workId;
        currentWorkBalance = parseFloat(work['–ù–∞ –±–∞–ª–∞–Ω—Å–µ']) || 0;
        
        document.getElementById('balanceWorkName').textContent = work['–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã'];
        document.getElementById('currentBalance').textContent = currentWorkBalance + ' ' + work['–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è'];
        document.getElementById('addBalanceAmount').value = '';
        document.getElementById('addBalanceModal').style.display = 'flex';
        document.getElementById('addBalanceAmount').focus();
    }

    function closeAddBalanceModal() {
        document.getElementById('addBalanceModal').style.display = 'none';
        currentWorkIdForBalance = null;
        currentWorkBalance = 0;
    }

    async function confirmAddBalance() {
        const amount = parseFloat(document.getElementById('addBalanceAmount').value);
        
        if (!amount || amount <= 0) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ', 'error');
            return;
        }
        
        try {
            const work = works.find(w => w.id === currentWorkIdForBalance);
            if (!work) {
                showNotification('–†–∞–±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                return;
            }
            
            showNotification('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫ –±–∞–ª–∞–Ω—Å—É...', 'success');
            
            const response = await fetch(buildApiUrl(`${API_CONFIG.ENDPOINTS.WORKS}/${currentWorkIdForBalance}/add-balance`), {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify({ amount })
            });
            
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(errorText || `HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('–ë–∞–ª–∞–Ω—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                closeAddBalanceModal();
                
                const balanceCell = document.querySelector(`tr:has(input[value="${currentWorkIdForBalance}"]) td:nth-child(6) input`);
                if (balanceCell) {
                    const newBalance = currentWorkBalance + amount;
                    balanceCell.value = newBalance;
                }
                
                const workIndex = works.findIndex(w => w.id === currentWorkIdForBalance);
                if (workIndex !== -1) {
                    works[workIndex]['–ù–∞ –±–∞–ª–∞–Ω—Å–µ'] = currentWorkBalance + amount;
                }
            } else {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞: ' + data.error, 'error');
            }
        } catch (error) {
            console.error('Add balance error:', error);
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞: ' + error.message, 'error');
        }
    }

    // ========== –ë–†–ò–ì–ê–î–ò–†–´ ==========
    async function loadForemen() {
        const loadingElement = document.getElementById('foremenLoading');
        const tableBody = document.getElementById('foremenTableBody');
        
        loadingElement.style.display = 'block';
        tableBody.innerHTML = '';
        
        try {
            const data = await makeApiRequest(API_CONFIG.ENDPOINTS.FOREMEN);
            
            if (data.success) {
                foremen = data.data || [];
                displayForemen(foremen);
            } else {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤: ' + data.error, 'error');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤: ' + error.message, 'error');
        } finally {
            loadingElement.style.display = 'none';
        }
    }
    
    function displayForemen(foremenToDisplay) {
        const tableBody = document.getElementById('foremenTableBody');
        tableBody.innerHTML = '';
        
        if (foremenToDisplay.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –±—Ä–∏–≥–∞–¥–∏—Ä–∞—Ö</td></tr>';
            return;
        }

        foremenToDisplay.forEach(foreman => {
            const row = document.createElement('tr');
            row.innerHTML = `‚êä
                <td><input type="text" value="${foreman.id}" readonly></td>‚êä
                <td><input type="text" value="${foreman.full_name || ''}" class="editable" data-field="full_name"></td>
                <td><input type="text" value="${foreman.position || ''}" class="editable" data-field="position"></td>
                <td><input type="text" value="${foreman.username || ''}" class="editable" data-field="username"></td>‚êä
                <td><input type="text" value="${foreman.registration_date || ''}" readonly></td>
                <td>
                    <select class="editable" data-field="is_active">
                        <option value="1" ${foreman.is_active ? 'selected' : ''}>‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω</option>
                        <option value="0" ${!foreman.is_active ? 'selected' : ''}>‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</option>
                    </select>
                </td>
                <td class="action-buttons">
                    <button onclick="saveForeman(${foreman.id})" class="secondary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button onclick="deleteForeman(${foreman.id})" class="danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }
    
    async function saveForeman(foremanId) {
        const row = document.querySelector(`tr:has(input[value="${foremanId}"])`);
        const inputs = row.querySelectorAll('.editable');
        
        const foremanData = { id: foremanId };
        inputs.forEach(input => {
            const field = input.getAttribute('data-field');
            let value = input.value;
            
            if (field === 'is_active') value = parseInt(value);
            
            foremanData[field] = value;
        });
        
        try {
            const response = await makeApiRequest(`${API_CONFIG.ENDPOINTS.FOREMEN}/${foremanId}`, {
                method: 'PUT',
                body: JSON.stringify(foremanData)
            });
            
            if (response.success) {
                showNotification('–î–∞–Ω–Ω—ã–µ –±—Ä–∏–≥–∞–¥–∏—Ä–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
            } else {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±—Ä–∏–≥–∞–¥–∏—Ä–∞: ' + (response.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±—Ä–∏–≥–∞–¥–∏—Ä–∞: ' + error.message, 'error');
        }
    }

    async function deleteForeman(foremanId) {
        if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –±—Ä–∏–≥–∞–¥–∏—Ä–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
            return;
        }
        
        try {
            const response = await makeApiRequest(`${API_CONFIG.ENDPOINTS.FOREMEN}/${foremanId}`, {
                method: 'DELETE'
            });
            
            if (response.success) {
                showNotification('–ë—Ä–∏–≥–∞–¥–∏—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω', 'success');
                await loadForemen();
            } else {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±—Ä–∏–≥–∞–¥–∏—Ä–∞: ' + (response.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±—Ä–∏–≥–∞–¥–∏—Ä–∞: ' + error.message, 'error');
        }
    }
    
    async function saveAllForemen() {
        showNotification('–§—É–Ω–∫—Ü–∏—è –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏', 'success');
    }
    
    function filterForemen() {
        const searchTerm = document.getElementById('searchForemen').value.toLowerCase();
        const filteredForemen = foremen.filter(foreman =>
            (foreman.full_name && foreman.full_name.toLowerCase().includes(searchTerm)) ||
            (foreman.position && foreman.position.toLowerCase().includes(searchTerm)) ||
            (foreman.username && foreman.username.toLowerCase().includes(searchTerm))
        );
        displayForemen(filteredForemen);
    }
    
    // ========== –û–¢–ß–ï–¢–´ ==========
    async function loadReports() {
        const loadingElement = document.getElementById('reportsLoading');
        const tableBody = document.getElementById('reportsTableBody');
        
        loadingElement.style.display = 'block';
        tableBody.innerHTML = '';
        
        try {
            reports = [];
            displayReports(reports);
            showNotification('–§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç—á–µ—Ç–æ–≤ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏', 'success');
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç—á–µ—Ç–æ–≤: ' + error.message, 'error');
        } finally {
            loadingElement.style.display = 'none';
        }
    }
    
    function displayReports(reportsToDisplay) {
        const tableBody = document.getElementById('reportsTableBody');
        tableBody.innerHTML = '';
        
        if (reportsToDisplay.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –æ—Ç—á–µ—Ç–∞—Ö</td></tr>';
            return;
        }
    }
    
    function addNewReport() {
        showNotification('–§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏', 'success');
    }
    
    async function saveAllReports() {
        showNotification('–§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏', 'success');
    }
    
    function filterReports() {}

    // ========== –ù–ê–ö–û–ü–ò–¢–ï–õ–¨–ù–ê–Ø –í–ï–î–û–ú–û–°–¢–¨ ==========
    let accumulativeData = [];

    function initializeAccumulativeTab() {
        document.getElementById('refreshAccumulative').addEventListener('click', loadAccumulativeStatement);
        document.getElementById('exportAccumulative').addEventListener('click', exportAccumulativeToExcel);
        document.getElementById('searchAccumulative').addEventListener('input', filterAccumulative);
    }

    async function loadAccumulativeStatement() {
        const loadingElement = document.getElementById('accumulativeLoading');
        const tableBody = document.getElementById('accumulativeTableBody');
        
        loadingElement.style.display = 'block';
        tableBody.innerHTML = '';
        
        try {
            const data = await makeApiRequest('/api/accumulative-statement');
            
            if (data.success) {
                accumulativeData = data.data || [];
                displayAccumulativeStatement(accumulativeData);
            } else {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–π –≤–µ–¥–æ–º–æ—Å—Ç–∏: ' + data.error, 'error');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–π –≤–µ–¥–æ–º–æ—Å—Ç–∏: ' + error.message, 'error');
        } finally {
            loadingElement.style.display = 'none';
        }
    }

    function displayAccumulativeStatement(data) {
        const tableBody = document.getElementById('accumulativeTableBody');
        tableBody.innerHTML = '';
        
        if (data.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
            return;
        }
        
        data.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${item.–ö–∞—Ç–µ–≥–æ—Ä–∏—è}</td>
                <td>${item.–†–∞–±–æ—Ç–∞}</td>
                <td>${item['–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è']}</td>
                <td>${item.–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ}</td>
                <td>${item.–ü—Ä–æ–µ–∫—Ç}</td>
                <td>${item['%–í—ã–ø–æ–ª–Ω–µ–Ω–∏—è']}%</td>
            `;
            tableBody.appendChild(row);
        });
    }

    function filterAccumulative() {
        const searchTerm = document.getElementById('searchAccumulative').value.toLowerCase();
        const filteredData = accumulativeData.filter(item =>
            item.–ö–∞—Ç–µ–≥–æ—Ä–∏—è.toLowerCase().includes(searchTerm) ||
            item.–†–∞–±–æ—Ç–∞.toLowerCase().includes(searchTerm)
        );
        displayAccumulativeStatement(filteredData);
    }

    async function exportAccumulativeToExcel() {
        try {
            showNotification('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è...', 'success');
            
            const workbook = XLSX.utils.book_new();
            workbook.Props = {
                Title: "–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è –≤–µ–¥–æ–º–æ—Å—Ç—å",
                Subject: "–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è –≤–µ–¥–æ–º–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç",
                Author: "WiTech System",
                CreatedDate: new Date()
            };

            const exportData = accumulativeData.map(item => ({
                '–ö–∞—Ç–µ–≥–æ—Ä–∏—è': item.–ö–∞—Ç–µ–≥–æ—Ä–∏—è,
                '–†–∞–±–æ—Ç–∞': item.–†–∞–±–æ—Ç–∞,
                '–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è': item['–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è'],
                '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': item.–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ,
                '–ü—Ä–æ–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ': item.–ü—Ä–æ–µ–∫—Ç,
                '% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è': item['%–í—ã–ø–æ–ª–Ω–µ–Ω–∏—è']
            }));

            const worksheet = XLSX.utils.json_to_sheet(exportData);
            
            const colWidths = [
                { wch: 25 },
                { wch: 40 },
                { wch: 18 },
                { wch: 14 },
                { wch: 18 },
                { wch: 16 }
            ];
            worksheet['!cols'] = colWidths;

            XLSX.utils.book_append_sheet(workbook, worksheet, "–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è –≤–µ–¥–æ–º–æ—Å—Ç—å");

            const fileName = `accumulative_statement_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(workbook, fileName);
            
            showNotification('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω', 'success');
        } catch (error) {
            console.error('Export error:', error);
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞: ' + error.message, 'error');
        }
    }

    // ========== –í–°–ï –û–¢–ß–ï–¢–´ ==========
    async function loadAllReports() {
        const loadingElement = document.getElementById('allReportsLoading');
        const tableBody = document.getElementById('allReportsTableBody');
        
        loadingElement.style.display = 'block';
        tableBody.innerHTML = '';
        
        try {
            const data = await makeApiRequest(API_CONFIG.ENDPOINTS.ALL_REPORTS);
            
            if (data.success) {
                allReports = data.data || [];
                displayAllReportsTable(allReports);
            } else {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç—á–µ—Ç–æ–≤: ' + data.error, 'error');
            }
        } catch (error) {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç—á–µ—Ç–æ–≤: ' + error.message, 'error');
        } finally {
            loadingElement.style.display = 'none';
        }
    }
    
    function displayAllReportsTable(reportsToDisplay) {
        const tableBody = document.getElementById('allReportsTableBody');
        tableBody.innerHTML = '';
        
        if (reportsToDisplay.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –æ—Ç—á–µ—Ç–∞—Ö</td></tr>';
            return;
        }

        reportsToDisplay.forEach(report => {
            const photoLink = report.photo_report_url ?
                `<a href="${report.photo_report_url}" target="_blank" style="color: var(--primary);">üì∑ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a>` :
                '–ù–µ—Ç —Ñ–æ—Ç–æ';

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${report.id}</td>
                <td>${report.foreman_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</td>
                <td>${report.foreman_position || '‚Äî'}</td>
                <td>${report.work_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</td>
                <td>${report.quantity} ${report.unit || '—à—Ç'}</td>
                <td>${report.report_date}</td>
                <td>${report.report_time}</td>
                <td>${photoLink}</td>
                <td class="action-buttons">
                    <button onclick="editReport(${report.id})" class="secondary">‚úèÔ∏è</button>
                    <button onclick="deleteReport(${report.id})" class="danger">üóëÔ∏è</button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }
    
    async function editReport(reportId) {
        showNotification('–§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏', 'success');
    }
    
    async function deleteReport(reportId) {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç—á–µ—Ç?')) {
            try {
                const response = await makeApiRequest(`${API_CONFIG.ENDPOINTS.REPORT}/${reportId}`, {
                    method: 'DELETE'
                });
                
                if (response.success) {
                    showNotification('–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω', 'success');
                    loadAllReports();
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞: ' + (response.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞: ' + error.message, 'error');
            }
        }
    }
    
    function filterAllReports() {
        const filteredReports = allReports.filter(report =>
            (report.foreman_name && report.foreman_name.toLowerCase().includes(searchTerm)) ||
            (report.foreman_position && report.foreman_position.toLowerCase().includes(searchTerm)) ||
            (report.work_name && report.work_name.toLowerCase().includes(searchTerm)) ||
            (report.report_date && report.report_date.toLowerCase().includes(searchTerm))
        );
        displayAllReportsTable(filteredReports);
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    function showNotification(message, type) {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.style.display = 'block';
        
        setTimeout(() => {
            notification.style.display = 'none';
        }, 5000);
    }
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –≤–æ–ª–Ω
    const waves = document.querySelector('.waves');
    let waveOffset = 0;
    
    function animateWaves() {
        waveOffset += 0.5;
        waves.style.backgroundPositionX = -waveOffset + 'px';
        requestAnimationFrame(animateWaves);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
    document.addEventListener('DOMContentLoaded', function() {
        const addBalanceInput = document.getElementById('addBalanceAmount');
        if (addBalanceInput) {
            addBalanceInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    confirmAddBalance();
                }
            });
        }
    });
    
    animateWaves();
    </script>
</body>
</html>